<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 6 Gráficos con ggplot2 | Documento Técnico N°6: Ciencia de Datos para el Turismo</title>
  <meta name="description" content="Ciencia de Datos para el Turismo" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 6 Gráficos con ggplot2 | Documento Técnico N°6: Ciencia de Datos para el Turismo" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Ciencia de Datos para el Turismo" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 6 Gráficos con ggplot2 | Documento Técnico N°6: Ciencia de Datos para el Turismo" />
  
  <meta name="twitter:description" content="Ciencia de Datos para el Turismo" />
  

<meta name="author" content="Dirección Nacional de Mercados y Estadísticas - Subsecretaría de Desarrollo Estratégico" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="manipulación-de-datos-ordenados.html"/>
<link rel="next" href="manipulación-de-datos-ordenados-usando-dplyr-y-tidyr-ii.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="imagenes/escudo_mintur.png"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Presentación</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#documento-técnico-nº6---resumen"><i class="fa fa-check"></i>Documento Técnico Nº6 - Resumen</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="ciencia-de-datos.html"><a href="ciencia-de-datos.html"><i class="fa fa-check"></i><b>1</b> Ciencia de Datos</a><ul>
<li class="chapter" data-level="1.1" data-path="ciencia-de-datos.html"><a href="ciencia-de-datos.html#por-qué-r"><i class="fa fa-check"></i><b>1.1</b> ¿Por qué R?</a></li>
<li class="chapter" data-level="1.2" data-path="ciencia-de-datos.html"><a href="ciencia-de-datos.html#cómo-decirle-a-r-qué-hacer"><i class="fa fa-check"></i><b>1.2</b> Cómo decirle a R qué hacer</a><ul>
<li class="chapter" data-level="1.2.1" data-path="ciencia-de-datos.html"><a href="ciencia-de-datos.html#orientándose-en-rstudio"><i class="fa fa-check"></i><b>1.2.1</b> Orientándose en RStudio</a></li>
<li class="chapter" data-level="1.2.2" data-path="ciencia-de-datos.html"><a href="ciencia-de-datos.html#hablando-con-r"><i class="fa fa-check"></i><b>1.2.2</b> Hablando con R</a></li>
<li class="chapter" data-level="1.2.3" data-path="ciencia-de-datos.html"><a href="ciencia-de-datos.html#extendiendo-r"><i class="fa fa-check"></i><b>1.2.3</b> Extendiendo R</a></li>
<li class="chapter" data-level="1.2.4" data-path="ciencia-de-datos.html"><a href="ciencia-de-datos.html#buscando-ayuda"><i class="fa fa-check"></i><b>1.2.4</b> Buscando ayuda</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="trabajar-con-proyectos-en-rstudio.html"><a href="trabajar-con-proyectos-en-rstudio.html"><i class="fa fa-check"></i><b>2</b> Trabajar con proyectos en RStudio</a><ul>
<li class="chapter" data-level="2.1" data-path="trabajar-con-proyectos-en-rstudio.html"><a href="trabajar-con-proyectos-en-rstudio.html#qué-ventajas-tiene"><i class="fa fa-check"></i><b>2.1</b> ¿Qué ventajas tiene?</a></li>
<li class="chapter" data-level="2.2" data-path="trabajar-con-proyectos-en-rstudio.html"><a href="trabajar-con-proyectos-en-rstudio.html#abrir-un-proyecto"><i class="fa fa-check"></i><b>2.2</b> Abrir un proyecto</a></li>
<li class="chapter" data-level="2.3" data-path="trabajar-con-proyectos-en-rstudio.html"><a href="trabajar-con-proyectos-en-rstudio.html#cómo-se-organiza"><i class="fa fa-check"></i><b>2.3</b> ¿Cómo se organiza?</a></li>
<li class="chapter" data-level="2.4" data-path="trabajar-con-proyectos-en-rstudio.html"><a href="trabajar-con-proyectos-en-rstudio.html#ordenando-aún-más"><i class="fa fa-check"></i><b>2.4</b> Ordenando aún más</a><ul>
<li class="chapter" data-level="2.4.1" data-path="trabajar-con-proyectos-en-rstudio.html"><a href="trabajar-con-proyectos-en-rstudio.html#borrón-y-cuenta-nueva-todos-los-días"><i class="fa fa-check"></i><b>2.4.1</b> Borrón y cuenta nueva… todos los días!</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introducción-a-rmarkdown.html"><a href="introducción-a-rmarkdown.html"><i class="fa fa-check"></i><b>3</b> Introducción a RMarkdown</a><ul>
<li class="chapter" data-level="3.1" data-path="introducción-a-rmarkdown.html"><a href="introducción-a-rmarkdown.html#creando-archivos-.rmd"><i class="fa fa-check"></i><b>3.1</b> Creando archivos .Rmd</a></li>
<li class="chapter" data-level="3.2" data-path="introducción-a-rmarkdown.html"><a href="introducción-a-rmarkdown.html#estructura-de-un-.rmd"><i class="fa fa-check"></i><b>3.2</b> Estructura de un .Rmd</a><ul>
<li class="chapter" data-level="3.2.1" data-path="introducción-a-rmarkdown.html"><a href="introducción-a-rmarkdown.html#encabezado"><i class="fa fa-check"></i><b>3.2.1</b> Encabezado</a></li>
<li class="chapter" data-level="3.2.2" data-path="introducción-a-rmarkdown.html"><a href="introducción-a-rmarkdown.html#bloques-de-código"><i class="fa fa-check"></i><b>3.2.2</b> Bloques de código</a></li>
<li class="chapter" data-level="3.2.3" data-path="introducción-a-rmarkdown.html"><a href="introducción-a-rmarkdown.html#el-texto-propio-del-documento."><i class="fa fa-check"></i><b>3.2.3</b> El texto propio del documento.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="introducción-a-rmarkdown.html"><a href="introducción-a-rmarkdown.html#markdown"><i class="fa fa-check"></i><b>3.3</b> Markdown</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="lectura-de-datos-ordenados.html"><a href="lectura-de-datos-ordenados.html"><i class="fa fa-check"></i><b>4</b> Lectura de datos ordenados</a><ul>
<li class="chapter" data-level="4.1" data-path="lectura-de-datos-ordenados.html"><a href="lectura-de-datos-ordenados.html#descargando-datos"><i class="fa fa-check"></i><b>4.1</b> Descargando datos</a></li>
<li class="chapter" data-level="4.2" data-path="lectura-de-datos-ordenados.html"><a href="lectura-de-datos-ordenados.html#leer-datos-csv"><i class="fa fa-check"></i><b>4.2</b> Leer datos csv</a></li>
<li class="chapter" data-level="4.3" data-path="lectura-de-datos-ordenados.html"><a href="lectura-de-datos-ordenados.html#leer-datos-de-excel"><i class="fa fa-check"></i><b>4.3</b> Leer datos de excel</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="manipulación-de-datos-ordenados.html"><a href="manipulación-de-datos-ordenados.html"><i class="fa fa-check"></i><b>5</b> Manipulación de datos ordenados</a><ul>
<li class="chapter" data-level="5.1" data-path="manipulación-de-datos-ordenados.html"><a href="manipulación-de-datos-ordenados.html#seleccionando-columnas-con-select"><i class="fa fa-check"></i><b>5.1</b> Seleccionando columnas con <code>select()</code></a></li>
<li class="chapter" data-level="5.2" data-path="manipulación-de-datos-ordenados.html"><a href="manipulación-de-datos-ordenados.html#filtrando-filas-con-filter"><i class="fa fa-check"></i><b>5.2</b> Filtrando filas con <code>filter()</code></a></li>
<li class="chapter" data-level="5.3" data-path="manipulación-de-datos-ordenados.html"><a href="manipulación-de-datos-ordenados.html#agrupando-y-reduciendo-con-group_by-summarise"><i class="fa fa-check"></i><b>5.3</b> Agrupando y reduciendo con <code>group_by() %&gt;% summarise()</code></a></li>
<li class="chapter" data-level="5.4" data-path="manipulación-de-datos-ordenados.html"><a href="manipulación-de-datos-ordenados.html#creando-nuevas-columnas-con-mutate"><i class="fa fa-check"></i><b>5.4</b> Creando nuevas columnas con <code>mutate()</code></a></li>
<li class="chapter" data-level="5.5" data-path="manipulación-de-datos-ordenados.html"><a href="manipulación-de-datos-ordenados.html#desagrupando-con-ungroup"><i class="fa fa-check"></i><b>5.5</b> Desagrupando con <code>ungroup()</code></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="gráficos-con-ggplot2.html"><a href="gráficos-con-ggplot2.html"><i class="fa fa-check"></i><b>6</b> Gráficos con ggplot2</a><ul>
<li class="chapter" data-level="6.1" data-path="gráficos-con-ggplot2.html"><a href="gráficos-con-ggplot2.html#primera-capa-el-área-del-gráfico"><i class="fa fa-check"></i><b>6.1</b> Primera capa: el área del gráfico</a></li>
<li class="chapter" data-level="6.2" data-path="gráficos-con-ggplot2.html"><a href="gráficos-con-ggplot2.html#segunda-capa-geometrías"><i class="fa fa-check"></i><b>6.2</b> Segunda capa: geometrías</a></li>
<li class="chapter" data-level="6.3" data-path="gráficos-con-ggplot2.html"><a href="gráficos-con-ggplot2.html#mapear-variables-a-elementos"><i class="fa fa-check"></i><b>6.3</b> Mapear variables a elementos</a></li>
<li class="chapter" data-level="6.4" data-path="gráficos-con-ggplot2.html"><a href="gráficos-con-ggplot2.html#otras-geometrías"><i class="fa fa-check"></i><b>6.4</b> Otras geometrías</a></li>
<li class="chapter" data-level="6.5" data-path="gráficos-con-ggplot2.html"><a href="gráficos-con-ggplot2.html#relación-entre-variables"><i class="fa fa-check"></i><b>6.5</b> Relación entre variables</a></li>
<li class="chapter" data-level="6.6" data-path="gráficos-con-ggplot2.html"><a href="gráficos-con-ggplot2.html#transformaciones-estadísticas"><i class="fa fa-check"></i><b>6.6</b> Transformaciones estadísticas</a></li>
<li class="chapter" data-level="6.7" data-path="gráficos-con-ggplot2.html"><a href="gráficos-con-ggplot2.html#gráficos-de-frecuencias"><i class="fa fa-check"></i><b>6.7</b> Gráficos de frecuencias</a><ul>
<li class="chapter" data-level="6.7.1" data-path="gráficos-con-ggplot2.html"><a href="gráficos-con-ggplot2.html#posición"><i class="fa fa-check"></i><b>6.7.1</b> Posición</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="gráficos-con-ggplot2.html"><a href="gráficos-con-ggplot2.html#gráficos-de-caja"><i class="fa fa-check"></i><b>6.8</b> Gráficos de caja</a></li>
<li class="chapter" data-level="6.9" data-path="gráficos-con-ggplot2.html"><a href="gráficos-con-ggplot2.html#graficando-en-múltiples-paneles"><i class="fa fa-check"></i><b>6.9</b> Graficando en múltiples paneles</a></li>
<li class="chapter" data-level="6.10" data-path="gráficos-con-ggplot2.html"><a href="gráficos-con-ggplot2.html#gráficos-de-líneas-suavizas"><i class="fa fa-check"></i><b>6.10</b> Gráficos de líneas suavizas</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="manipulación-de-datos-ordenados-usando-dplyr-y-tidyr-ii.html"><a href="manipulación-de-datos-ordenados-usando-dplyr-y-tidyr-ii.html"><i class="fa fa-check"></i><b>7</b> Manipulación de datos ordenados usando dplyr y tidyr II</a><ul>
<li class="chapter" data-level="7.1" data-path="manipulación-de-datos-ordenados-usando-dplyr-y-tidyr-ii.html"><a href="manipulación-de-datos-ordenados-usando-dplyr-y-tidyr-ii.html#de-ancho-a-largo-con-pivot_longer"><i class="fa fa-check"></i><b>7.1</b> De ancho a largo con <code>pivot_longer()</code></a></li>
<li class="chapter" data-level="7.2" data-path="manipulación-de-datos-ordenados-usando-dplyr-y-tidyr-ii.html"><a href="manipulación-de-datos-ordenados-usando-dplyr-y-tidyr-ii.html#de-largo-a-ancho-con-pivot_wider"><i class="fa fa-check"></i><b>7.2</b> De largo a ancho con <code>pivot_wider()</code></a></li>
<li class="chapter" data-level="7.3" data-path="manipulación-de-datos-ordenados-usando-dplyr-y-tidyr-ii.html"><a href="manipulación-de-datos-ordenados-usando-dplyr-y-tidyr-ii.html#uniendo-tablas"><i class="fa fa-check"></i><b>7.3</b> Uniendo tablas</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="tablas.html"><a href="tablas.html"><i class="fa fa-check"></i><b>8</b> Tablas</a><ul>
<li class="chapter" data-level="8.1" data-path="tablas.html"><a href="tablas.html#tablas-simples-con-kable"><i class="fa fa-check"></i><b>8.1</b> Tablas simples con <code>kable</code></a></li>
<li class="chapter" data-level="8.2" data-path="tablas.html"><a href="tablas.html#supertablas-con-kableextra"><i class="fa fa-check"></i><b>8.2</b> Supertablas con kableExtra</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="apariencia-de-gráficos.html"><a href="apariencia-de-gráficos.html"><i class="fa fa-check"></i><b>9</b> Apariencia de gráficos</a><ul>
<li class="chapter" data-level="9.1" data-path="apariencia-de-gráficos.html"><a href="apariencia-de-gráficos.html#escalas"><i class="fa fa-check"></i><b>9.1</b> Escalas</a><ul>
<li class="chapter" data-level="9.1.1" data-path="apariencia-de-gráficos.html"><a href="apariencia-de-gráficos.html#escala-de-colores-y-otras"><i class="fa fa-check"></i><b>9.1.1</b> Escala de colores y otras</a></li>
<li class="chapter" data-level="9.1.2" data-path="apariencia-de-gráficos.html"><a href="apariencia-de-gráficos.html#escalas-de-ejes"><i class="fa fa-check"></i><b>9.1.2</b> Escalas de ejes</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="apariencia-de-gráficos.html"><a href="apariencia-de-gráficos.html#elementos-de-texto"><i class="fa fa-check"></i><b>9.2</b> Elementos de texto</a></li>
<li class="chapter" data-level="9.3" data-path="apariencia-de-gráficos.html"><a href="apariencia-de-gráficos.html#temas"><i class="fa fa-check"></i><b>9.3</b> Temas</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="informes-reproducibles.html"><a href="informes-reproducibles.html"><i class="fa fa-check"></i><b>10</b> Informes reproducibles</a><ul>
<li class="chapter" data-level="10.1" data-path="informes-reproducibles.html"><a href="informes-reproducibles.html#eligiendo-el-formato-de-salida"><i class="fa fa-check"></i><b>10.1</b> Eligiendo el formato de salida</a></li>
<li class="chapter" data-level="10.2" data-path="informes-reproducibles.html"><a href="informes-reproducibles.html#personalizando-la-salida"><i class="fa fa-check"></i><b>10.2</b> Personalizando la salida</a></li>
<li class="chapter" data-level="10.3" data-path="informes-reproducibles.html"><a href="informes-reproducibles.html#reportes-parametrizados"><i class="fa fa-check"></i><b>10.3</b> Reportes parametrizados</a></li>
<li class="chapter" data-level="10.4" data-path="informes-reproducibles.html"><a href="informes-reproducibles.html#control-de-chunks"><i class="fa fa-check"></i><b>10.4</b> Control de chunks</a></li>
</ul></li>
<li class="appendix"><span><b>Apéndice</b></span></li>
<li class="chapter" data-level="A" data-path="desafíos-de-práctica.html"><a href="desafíos-de-práctica.html"><i class="fa fa-check"></i><b>A</b> Desafíos de práctica</a><ul>
<li class="chapter" data-level="" data-path="desafíos-de-práctica.html"><a href="desafíos-de-práctica.html#desafío-1"><i class="fa fa-check"></i>Desafío 1</a></li>
<li class="chapter" data-level="" data-path="desafíos-de-práctica.html"><a href="desafíos-de-práctica.html#desafío-2"><i class="fa fa-check"></i>Desafío 2</a></li>
<li class="chapter" data-level="" data-path="desafíos-de-práctica.html"><a href="desafíos-de-práctica.html#desafío-3"><i class="fa fa-check"></i>Desafío 3</a></li>
<li class="chapter" data-level="" data-path="desafíos-de-práctica.html"><a href="desafíos-de-práctica.html#desafío-4"><i class="fa fa-check"></i>Desafío 4</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="instalando-r-y-rstudio.html"><a href="instalando-r-y-rstudio.html"><i class="fa fa-check"></i><b>B</b> Instalando R y RStudio</a><ul>
<li class="chapter" data-level="" data-path="instalando-r-y-rstudio.html"><a href="instalando-r-y-rstudio.html#instalando-r"><i class="fa fa-check"></i>Instalando R</a><ul>
<li class="chapter" data-level="" data-path="instalando-r-y-rstudio.html"><a href="instalando-r-y-rstudio.html#windows"><i class="fa fa-check"></i>Windows</a></li>
<li class="chapter" data-level="" data-path="instalando-r-y-rstudio.html"><a href="instalando-r-y-rstudio.html#ubuntu-o-derivados"><i class="fa fa-check"></i>Ubuntu o derivados</a></li>
</ul></li>
<li class="chapter" data-level="B.1" data-path="instalando-r-y-rstudio.html"><a href="instalando-r-y-rstudio.html#mac"><i class="fa fa-check"></i><b>B.1</b> Mac</a></li>
<li class="chapter" data-level="" data-path="instalando-r-y-rstudio.html"><a href="instalando-r-y-rstudio.html#instalando-rstudio"><i class="fa fa-check"></i>Instalando RStudio</a><ul>
<li class="chapter" data-level="" data-path="instalando-r-y-rstudio.html"><a href="instalando-r-y-rstudio.html#windows-1"><i class="fa fa-check"></i>Windows</a></li>
<li class="chapter" data-level="" data-path="instalando-r-y-rstudio.html"><a href="instalando-r-y-rstudio.html#ubuntu-o-derivados-1"><i class="fa fa-check"></i>Ubuntu o derivados</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><b><a href="http://www.yvera.gob.ar/estadistica" target="blank">Estadísticas de Turismo</a></b></li>
<li><a href="http://datos.yvera.gob.ar/" target="blank">Datos Abiertos de Turismo</a></li>
<li><a href="https://tableros.yvera.tur.ar/" target="blank">Tableros y Reportes</a></li>
<li><a href="https://www.yvera.tur.ar/estadistica/informe" target="blank">Informes</a></li>
<li><a href="https://armonizacion.yvera.tur.ar/" target="blank">Armonización</a></li>
<li><a href="https://bitacora.yvera.tur.ar/" target="blank">Bitácora</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Documento Técnico N°6: Ciencia de Datos para el Turismo</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<link href="style.css" rel="stylesheet">
<div class="hero-image-container"> 
  <img class= "hero-image" src="imagenes/cabezal.png">
</div>
<div id="gráficos-con-ggplot2" class="section level1">
<h1><span class="header-section-number">Capítulo 6</span> Gráficos con ggplot2</h1>
<p>Visualizar datos es útil para identificar a relación entre distintas variables pero también para comunicar el análisis de los datos y resultados.
El paquete <strong>ggplot2</strong> permite generar gráficos de gran calidad en pocos pasos.
Cualquier gráfico de ggplot tendrá como mínimo 3 componentes: los <strong>datos</strong>, un <strong>sistema de coordenadas</strong> y una <strong>geometría</strong> (la representación visual de los datos) y se irá construyendo por capas.</p>
<div id="primera-capa-el-área-del-gráfico" class="section level2">
<h2><span class="header-section-number">6.1</span> Primera capa: el área del gráfico</h2>
<p>Cómo siempre, primero hay que cargar los paquetes y los datos.
Para esta sección, vamos a leer el archivo parques_tidy.csv, que es una serie de tiempo de visitantes a parques nacionales descargada de <a href="http://datos.yvera.gob.ar/dataset/parques-nacionales/archivo/78aea6ed-761c-4659-bdf2-7fcb0f616fad">Yvera</a> y modificada un poco para poder trabajar con ella más fácilmente con ggplot2.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="gráficos-con-ggplot2.html#cb66-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb66-2"><a href="gráficos-con-ggplot2.html#cb66-2"></a>parques &lt;-<span class="st"> </span>readr<span class="op">::</span><span class="kw">read_csv</span>(<span class="st">&quot;datos/parques_tidy.csv&quot;</span>)</span></code></pre></div>
<p>Para tener una idea de este conjunto de datos, <code>head()</code> muestra las primeras 6 filas</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="gráficos-con-ggplot2.html#cb67-1"></a><span class="kw">head</span>(parques)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   indice_tiempo region       residentes noresidentes  total
##   &lt;date&gt;        &lt;chr&gt;             &lt;dbl&gt;        &lt;dbl&gt;  &lt;dbl&gt;
## 1 2008-01-01    buenos-aires        885            0    885
## 2 2008-01-01    cordoba             717          145    862
## 3 2008-01-01    cuyo               4965          179   5144
## 4 2008-01-01    litoral          111408        55335 166743
## 5 2008-01-01    norte              4241          774   5016
## 6 2008-01-01    patagonia        230087       141973 372060</code></pre>
<p>La tabla tiene</p>
<ul>
<li><strong>indice_tiempo</strong>: fecha que representa el mes,</li>
<li><strong>region</strong>: texto con la región,</li>
<li><strong>residentes</strong>: cantidad de visitantes residentes que visitaron cada región en cada fecha,</li>
<li><strong>noresidentes</strong>: cantidad de visitantes no residentes,</li>
<li><strong>total</strong>: cantidad todal de visitantes (la suma de <code>residentes</code> y <code>noresidentes</code>)</li>
</ul>
<p>La función principal de ggplot2 es justamente <code>ggplot()</code> que permite <em>iniciar</em> el gráfico y además definir las características <em>globales</em>.
El primer argumento de esta función serán los datos que vas a visualizar, siempre en un data frame.
En este caso usamos <code>parques</code>.</p>
<p>El segundo argumento se llama “mapping” (<em>mapeo</em> en inglés).
Este argumento define la relación entre cada columna del data frame y los distintos parámetros gráficos. Por ejemplo, qué columna va a representar el eje x, cuál va a ser el eje y, etc..
Este mapeo se hace <strong>siempre</strong> con la función <code>aes()</code> (que viene de <em>aesthetics</em>, <em>estética</em> en inglés).</p>
<p>Por ejemplo, si querés hacer un gráfico que muestre la relación entre la cantidad de visitantes residentes y no residentes usarías algo como esto:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="gráficos-con-ggplot2.html#cb69-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> parques, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> noresidentes, <span class="dt">y =</span> residentes))</span></code></pre></div>
<p><img src="DT6_files/figure-html/unnamed-chunk-47-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Este código le indica a ggplot que genere un gráfico donde el eje <strong>x</strong> se mapea a la columna <code>noresidentes</code> y el eje <strong>y</strong>, a la columna <code>residentes</code>.
Pero, como se ve, esto sólo genera el área del gráfico y los ejes.
Lo que falta es indicar con qué geometrías representar los datos.</p>
</div>
<div id="segunda-capa-geometrías" class="section level2">
<h2><span class="header-section-number">6.2</span> Segunda capa: geometrías</h2>
<p>Para agregar geometrías que representen los datos lo que hay que hacer es <em>sumar</em> el resultado de una función que devuelva una capa de geometrías.
Estas suelen ser funciones que empiezan con “geom_” y luego el nombre de la geometría (en inglés).
Para representar los datos usando puntos, hay que uasr <code>geom_point()</code></p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="gráficos-con-ggplot2.html#cb70-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> parques, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> noresidentes, <span class="dt">y =</span> residentes)) <span class="op">+</span></span>
<span id="cb70-2"><a href="gráficos-con-ggplot2.html#cb70-2"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="DT6_files/figure-html/unnamed-chunk-48-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>¡Tu primer gráfico!</p>
<div class="alert alert-info">
<p><strong>Primer desafío</strong></p>
<p>Ahora es tu turno.
Modifica el gráfico anterior para visualizar cómo cambia la cantidad de visitantes residentes a lo largo de los años.</p>
<p>¿Te parece útil este gráfico?</p>
</div>
<p>Este gráfico tiene un punto por cada región y cada trimestre, pero es posible identificar a qué región corresponde cada punto.
Es necesario agregar información al gráfico.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="gráficos-con-ggplot2.html#cb71-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> parques, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> indice_tiempo, <span class="dt">y =</span> residentes)) <span class="op">+</span></span>
<span id="cb71-2"><a href="gráficos-con-ggplot2.html#cb71-2"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="DT6_files/figure-html/unnamed-chunk-49-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="mapear-variables-a-elementos" class="section level2">
<h2><span class="header-section-number">6.3</span> Mapear variables a elementos</h2>
<p>Una posible solución sería utilizar otras variables de los datos, por ejemplo <code>region</code> y <em>mapear</em> el color de los puntos de a cuerdo a la región a la que pertenecen.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="gráficos-con-ggplot2.html#cb72-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> parques, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> indice_tiempo, <span class="dt">y =</span> residentes)) <span class="op">+</span></span>
<span id="cb72-2"><a href="gráficos-con-ggplot2.html#cb72-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> region))</span></code></pre></div>
<p><img src="DT6_files/figure-html/unnamed-chunk-50-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Ahh, ahora está un poco mejor.
Se puede ver que la Patagonia (los puntos fucsia) tiene más visitantes que el resto de las regiones.
Le sigue la región del Litoral (puntos turquesa).</p>
<p>Algo muy importante a tener en cuenta: <strong>los puntos toman un color de acuerdo a una variable de los datos</strong>, y para que ggplot2 identifique esa variable (en este caso <code>region</code>) es necesario incluirla dentro de una función <code>aes()</code>.</p>
</div>
<div id="otras-geometrías" class="section level2">
<h2><span class="header-section-number">6.4</span> Otras geometrías</h2>
<p>Este gráfico posiblemente no sea muy adecuado si queremos visualizar la <em>evolución</em> de una variable a lo largo del tiempo.
Si bien se pueden identificar a qué región correponde cada punto, es muy difícil seguir la evolución de uno en particular; especialmente en la Patagonia, donde hay mucha distancia vertical entre los puntos.
Lo más natural es cambiar la geometría a lineas usando <code>geom_line()</code></p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="gráficos-con-ggplot2.html#cb73-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> parques, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> indice_tiempo, <span class="dt">y =</span> residentes)) <span class="op">+</span></span>
<span id="cb73-2"><a href="gráficos-con-ggplot2.html#cb73-2"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> region))</span></code></pre></div>
<p><img src="DT6_files/figure-html/unnamed-chunk-51-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Por suerte las funciones <code>geom_*()</code> tienen más o menos nombres amigables.</p>
<p>Y ahora si, conseguimos el gráfico que estamos buscando.
Las líneas unen puntos consecutivos y permiten que el ojo siga la evolución de cada región.
La diferencia entre temporada alta y temporada baja en Patagonia (la estacionalidad) salta inmediatamente.</p>
<div class="alert alert-info">
<p><strong>Segundo desafío</strong></p>
<p>Hasta ahora tenemos dos capas: el área del gráfico y una única geometría (las líneas).</p>
<ol style="list-style-type: decimal">
<li>Sumá una tercera capa para visualizar puntos además de las líneas.</li>
<li>¿Porqué los puntos ahora no siguen los colores de las regiones?</li>
<li>¿Qué cambio podrías hacer para que los puntos también tengan color según la región?</li>
</ol>
</div>
<p>Acá surge una característica importante de las capas: pueden tener apariencia independiente si solo <em>mapeamos</em> el color en la capa de las líneas y no en la capa de los puntos.
Al mismo tiempo, si quisiéramos que todas las capas tenga la misma apariencia podemos incluir el argumento <code>color =</code>en la función global <code>ggpplot()</code> o repetirlo en cada capa.</p>
<p>Es la diferencia entre esto</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="gráficos-con-ggplot2.html#cb74-1"></a><span class="kw">ggplot</span>(parques, <span class="kw">aes</span>(indice_tiempo, residentes)) <span class="op">+</span></span>
<span id="cb74-2"><a href="gráficos-con-ggplot2.html#cb74-2"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> region)) <span class="op">+</span></span>
<span id="cb74-3"><a href="gráficos-con-ggplot2.html#cb74-3"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="DT6_files/figure-html/unnamed-chunk-52-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>y esto.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="gráficos-con-ggplot2.html#cb75-1"></a><span class="kw">ggplot</span>(parques, <span class="kw">aes</span>(indice_tiempo, residentes, <span class="dt">color =</span> region)) <span class="op">+</span></span>
<span id="cb75-2"><a href="gráficos-con-ggplot2.html#cb75-2"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb75-3"><a href="gráficos-con-ggplot2.html#cb75-3"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="DT6_files/figure-html/unnamed-chunk-53-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="alert alert-success">
<p>Si te preguntás a donde fueron a parar el <code>data =</code>, el <code>mapping =</code> y los nombres de los argumentos adentro de la función <code>aes()</code>, <code>x =</code> e <code>y =</code>, resulta que estamos aprovechando que tanto ggplot2 como nosotros ahora sabemos en que orden recibe la información cada función.
Siempre el primer elemento que le <em>pases</em> o indiquemos a la función <code>ggplot()</code> será el data frame y el segundo será el <code>aes()</code>.</p>
</div>
<p>Algunos argumentos para cambiar la apariencia de las geometrías son:</p>
<ul>
<li><code>color</code> o <code>colour</code> modifica el color de líneas y puntos</li>
<li><code>fill</code> modifica el color <em>interno</em> de un elemento, por ejemplo el relleno de una barra</li>
<li><code>linetype</code> modifica el tipo de línea (punteada, continua, con guiones, etc…)</li>
<li><code>size</code> modifica el tamaño de los elementos (por ejemplo el tamaño de puntos o el grosor de líneas)</li>
<li><code>alpha</code> modifica la transparencia de los elementos (1 = opaco, 0 = transparente)</li>
<li><code>shape</code> modifica el tipo de punto (círculos, cuadrados, triángulos, etc.)</li>
</ul>
<p>El <em>mapeo</em> entre una variable y un parámetro de geometría se hace a través de una <strong>escala</strong>.
La escala de colores es lo que define, por ejemplo, que los puntos donde la variable <code>region</code> toma el valor <code>"patagonia"</code> van a tener el color rosa (<span style="color:#FB61D7">●</span>), donde toma el valor <code>córdoba"</code>, mostaza (<span style="color:#B79F00">●</span>), etc…</p>
<div class="alert alert-success">
<p><strong>Modificar elementos utilizando un valor único</strong></p>
<p>Es posible que en algún momento necesites cambiar la apariencia de los elementos o geometrías independientemente de las variables de tu data frame.
Por ejemplo podrías querer que todos los puntos sean de un único color: rojos.
En este caso <code>geom_point(aes(color = "red"))</code> no va a funcionar -ojo que los colores van en inglés-.
Lo que ese código hace es mapear el parámetro geométrico “color” a una variable que contiene el valor <code>"red"</code> para todas las filas.
El mapeo se hace a través de la escala, que va a asignarle un valor (rosa <span style="color:#FB61D7">●</span>) a los puntos correspondientes al valor <code>"red"</code>.</p>
<p>Como en este caso no te interesa <em>mapear</em> el color a una variable, tenés que mover ese argumento <strong>afuera</strong> de la función <code>aes()</code>: <code>geom_point(color = "red")</code>.</p>
</div>
</div>
<div id="relación-entre-variables" class="section level2">
<h2><span class="header-section-number">6.5</span> Relación entre variables</h2>
<p>Muchas veces no es suficiente con mirar los datos crudos para identificar la relación entre las variables; es necesario usar alguna transformación estadística que resalte esas relaciones, ya sea ajustando una recta o calculando promedios.</p>
<p>Para alguna transformaciones estadísticas comunes, ggplot2 tiene geoms ya programados, pero muchas veces es posible que necesites manipular los datos antes de poder hacer un gráfico.
A veces esa manipulación será compleja y su resultado luego va a ser utilizado en otras partes del análisis.
En esos casos, te conviene guardar los datos modificados en una nueva variable.
Pero para transformaciones más simples podés <em>encadenar</em> la manipulación de los datos directamente en el gráfico.</p>
<p>Por ejemplo, en un gráfico anterior viste que hay un ciclo estacional bastante notorio en la cantidad de visitantes.
Para visualizar el ciclo anual medio de toda la serie podés calcular la cantidad promedio de visitantes por cada mes y región usando <a href="05-dplyr-I.html">dplyr</a> y luego graficar eso:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="gráficos-con-ggplot2.html#cb76-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb76-2"><a href="gráficos-con-ggplot2.html#cb76-2"></a></span>
<span id="cb76-3"><a href="gráficos-con-ggplot2.html#cb76-3"></a>parques <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb76-4"><a href="gráficos-con-ggplot2.html#cb76-4"></a><span class="st">  </span><span class="kw">group_by</span>(<span class="dt">mes =</span> lubridate<span class="op">::</span><span class="kw">month</span>(indice_tiempo), region) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb76-5"><a href="gráficos-con-ggplot2.html#cb76-5"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">residentes_medios =</span> <span class="kw">mean</span>(residentes)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb76-6"><a href="gráficos-con-ggplot2.html#cb76-6"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(mes, residentes_medios)) <span class="op">+</span></span>
<span id="cb76-7"><a href="gráficos-con-ggplot2.html#cb76-7"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color=</span> region))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;mes&#39;. You can override using the `.groups` argument.</code></pre>
<p><img src="DT6_files/figure-html/unnamed-chunk-54-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Esto es posible gracias al operador <code>%&gt;%</code> que le <em>pasa</em> el resultado de <code>summarise()</code> a la función <code>ggplot()</code>.
Y este resultado no es ni más ni menos que el data frame que necesitás para hacer el gráfico.
Es importante notar que una vez que comenzamos el gráfico ya <strong>no</strong> se puede usar el operador <code>%&gt;%</code> y las capas del gráfico se <em>suman</em> como siempre con <code>+</code>.</p>
<p>El gráfico muestra que en un enero típico, los parques de la región Patagonia esperan algo más de 300.000 visitantes residentes, mientras que en junio tienen menos de 25.000.
La cantidad de visitas de residentes a los parques del litoral es un poco más constante a lo largo del año.</p>
<p>Una vez analizado el ciclo anual, podrías querer filtrarlo de los datos para obtener una serie <em>desestacionada</em>.
Una forma de hacerlo es restando la media así:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="gráficos-con-ggplot2.html#cb78-1"></a>parques <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb78-2"><a href="gráficos-con-ggplot2.html#cb78-2"></a><span class="st">  </span><span class="kw">group_by</span>(<span class="dt">trimestre =</span> lubridate<span class="op">::</span><span class="kw">month</span>(indice_tiempo), region) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb78-3"><a href="gráficos-con-ggplot2.html#cb78-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">residentes =</span> residentes <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(residentes)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb78-4"><a href="gráficos-con-ggplot2.html#cb78-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(indice_tiempo, residentes)) <span class="op">+</span></span>
<span id="cb78-5"><a href="gráficos-con-ggplot2.html#cb78-5"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color=</span> region)) </span></code></pre></div>
<p><img src="DT6_files/figure-html/unnamed-chunk-55-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Al filtra el ciclo anual medio, saltan a la vista otros patrones de variabilidad.
Se puede ver que tanto en la Patagonia como en el Litoral la cantidad de visitantes residentes estuvo aumentando hasta 2020, cuando a causa de la pandemia, la visitas se desplomaron.
También se pueden destacar meses interesantes donde los parques recibieron muchos más visitantes de lo que es normal para ese mes.</p>
<div class="alert alert-info">
<p><strong>Tercer desafío</strong></p>
<p>Modificá el siguiente código para obtener el gráfico que se muestra más abajo.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="gráficos-con-ggplot2.html#cb79-1"></a>parques <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb79-2"><a href="gráficos-con-ggplot2.html#cb79-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">anio =</span> lubridate<span class="op">::</span><span class="kw">year</span>(indice_tiempo)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb79-3"><a href="gráficos-con-ggplot2.html#cb79-3"></a><span class="st">  </span><span class="kw">group_by</span>(region, ____) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb79-4"><a href="gráficos-con-ggplot2.html#cb79-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">total =</span> <span class="kw">mean</span>(total)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb79-5"><a href="gráficos-con-ggplot2.html#cb79-5"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(anio, ___)) <span class="op">+</span><span class="st">  </span></span>
<span id="cb79-6"><a href="gráficos-con-ggplot2.html#cb79-6"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> region)) <span class="op">+</span></span>
<span id="cb79-7"><a href="gráficos-con-ggplot2.html#cb79-7"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> region), <span class="dt">shape =</span> ____, <span class="dt">size =</span> <span class="dv">3</span>) </span></code></pre></div>
<p><img src="DT6_files/figure-html/unnamed-chunk-57-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="transformaciones-estadísticas" class="section level2">
<h2><span class="header-section-number">6.6</span> Transformaciones estadísticas</h2>
<p>Hasta ahora visualizamos los datos tal cual vienen en la base de datos o transformados con ayuda de dplyr, pero hay ciertas transformaciones comunes que se pueden hacer usando ggplot2.</p>
<p>Para esta sección vamos a usar datos de la <a href="http://datos.yvera.gob.ar/dataset/encuesta-viajes-turismo-hogares-evyth">Encuesta de Viajes y Turismo de los Hogares</a> (EVYTH).
Vamos a seleccionar sólo las columnas que identifican cada hogar y viaje, y el gasto del viaje y el quintil de ingreso del hogar.
Como cada fila es una persona y cada hogar puede tener más de una persona, el código de abajo usa <code>distinct()</code> para eliminar los valores repetidos.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="gráficos-con-ggplot2.html#cb80-1"></a>gastos &lt;-<span class="st"> </span>readr<span class="op">::</span><span class="kw">read_csv</span>(<span class="st">&quot;datos/evyth_2019_2021t1.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb80-2"><a href="gráficos-con-ggplot2.html#cb80-2"></a><span class="st">  </span><span class="kw">select</span>(id_hogar, id_viajes, anio, trimestre, </span>
<span id="cb80-3"><a href="gráficos-con-ggplot2.html#cb80-3"></a>         region_destino, <span class="dt">gasto =</span> gasto_pc, <span class="dt">quintil =</span> quintil_pcf_visitante) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb80-4"><a href="gráficos-con-ggplot2.html#cb80-4"></a><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb80-5"><a href="gráficos-con-ggplot2.html#cb80-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">region_destino =</span> <span class="kw">factor</span>(region_destino))</span></code></pre></div>
</div>
<div id="gráficos-de-frecuencias" class="section level2">
<h2><span class="header-section-number">6.7</span> Gráficos de frecuencias</h2>
<p>Este es un gráfico de barras construido usando la función <code>geom_bar()</code>.
En el eje x muestra el <code>quintil</code> de cada hogar y en el eje y la cantidad (<em>count</em> en inglés) de hogares en ese quintil.
Habrás notado que el data frame <code>gastos</code> no tiene ninguna variable que se llame <code>count</code> y en ninguna parte del código se calcula esa cantidad explícitamente.
Esta variable es computada por <code>geom_bar()</code>.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="gráficos-con-ggplot2.html#cb81-1"></a><span class="kw">ggplot</span>(gastos, <span class="kw">aes</span>(quintil)) <span class="op">+</span></span>
<span id="cb81-2"><a href="gráficos-con-ggplot2.html#cb81-2"></a><span class="st">  </span><span class="kw">geom_bar</span>()</span></code></pre></div>
<p><img src="DT6_files/figure-html/unnamed-chunk-59-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="alert alert-info">
<p><strong>Tercer desafío</strong></p>
<p>¿Qué otra variable, además de <code>count</code> computa <code>geom_bar()</code>?
Andá a la documentación de <code>geom_bar()</code> (apretando F1 sobre el nombre de la función o ejecutando <code>?geom_bar</code> en la consola) y andá a la sección llamada “Computed variables” para verlo.</p>
</div>
<p>Además de contar la cantidad de elementos, <code>geom_bar()</code> computa la proporción sobre el total que representa grada grupo con la variable computada <code>prop</code>.
Para usar esa variable computada como la altura de las barras hay que usar la función <code>stat()</code> dentro del <code>aes()</code>.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="gráficos-con-ggplot2.html#cb82-1"></a><span class="kw">ggplot</span>(gastos, <span class="kw">aes</span>(quintil)) <span class="op">+</span></span>
<span id="cb82-2"><a href="gráficos-con-ggplot2.html#cb82-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">stat</span>(prop)))</span></code></pre></div>
<p><img src="DT6_files/figure-html/unnamed-chunk-60-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Ahora podés ver que casi el 60% de las familias encuestadas pertenecen al quintil 5.</p>
<p>Para obtener algo parecido pero para variables continuas hay que usar <code>geom_histogram()</code>.
Un ejemplo de variable continua es el <code>gasto</code> asociado a cada viaje.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="gráficos-con-ggplot2.html#cb83-1"></a><span class="kw">ggplot</span>(gastos, <span class="kw">aes</span>(gasto)) <span class="op">+</span></span>
<span id="cb83-2"><a href="gráficos-con-ggplot2.html#cb83-2"></a><span class="st">  </span><span class="kw">geom_histogram</span>() </span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="DT6_files/figure-html/unnamed-chunk-61-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Algo que sucede muy seguido con medidas de gastos e ingresos, es que esta variable tiene una distribución altamente asimétrica.
Es decir, hay muchos viajes con valores muy bajos y muy pocos con valores muy altos.
Esto hace que se pierda detalle en el rango de valores donde se encuentra la mayoría de las observaciones.
Una forma de resolver esto es transformando los valores con el logaritmo, pero graficar el logaritmo del gasto no sería muy fácil de interpretar.
En vez de eso, es recomendable utilizar una transformación de escala en el gráfico.</p>
<p>Para transformar los valores del eje x con el logaritmo, se usa <code>scale_x_log10()</code>.
Esto realiza la transformación pero luego muestra las etiquetas en la escala original.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="gráficos-con-ggplot2.html#cb85-1"></a><span class="kw">ggplot</span>(gastos, <span class="kw">aes</span>(gasto)) <span class="op">+</span></span>
<span id="cb85-2"><a href="gráficos-con-ggplot2.html#cb85-2"></a><span class="st">  </span><span class="kw">geom_histogram</span>() <span class="op">+</span></span>
<span id="cb85-3"><a href="gráficos-con-ggplot2.html#cb85-3"></a><span class="st">  </span><span class="kw">scale_x_log10</span>()</span></code></pre></div>
<pre><code>## Warning: Transformation introduced infinite values in continuous x-axis</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<pre><code>## Warning: Removed 853 rows containing non-finite values (stat_bin).</code></pre>
<p><img src="DT6_files/figure-html/unnamed-chunk-62-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="alert alert-info">
<p><strong>Primer desafío</strong></p>
<p>¿Notaste el mensaje que devuelve el gráfico?</p>
<p>`<code>stat_bin()</code> using <code>bins = 30</code>.
Pick better value with <code>binwidth</code>.`</p>
<p>Esta geometría tiene dos argumentos importantes <code>bins</code> y <code>binwidth</code>.
Cambiá el valor de alguno de los dos argumentos y volvé a generar el gráfico, ¿que rol juegan los argumentos?</p>
<p>También podés revisar la documentación.</p>
</div>
<div id="posición" class="section level3">
<h3><span class="header-section-number">6.7.1</span> Posición</h3>
<p>Es posible que la distribución en quintiles de los visitantes no sea igual para cada región, entonces podrías querer dibujar una barra para cada quintil y cada región e identificar cada quintil con un color disitnto.
Siguiendo lo anterior, quizás lo primero que se te ocurre es algo como esto:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="gráficos-con-ggplot2.html#cb89-1"></a><span class="kw">ggplot</span>(gastos) <span class="op">+</span></span>
<span id="cb89-2"><a href="gráficos-con-ggplot2.html#cb89-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(quintil, <span class="dt">color =</span> region_destino))</span></code></pre></div>
<p><img src="DT6_files/figure-html/unnamed-chunk-63-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>El problema de esto es que el parámetro “color” de las barras define el color del contorno, no el relleno.
Para modificar el relleno hay que cambiar el parámetro <code>fill</code>.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="gráficos-con-ggplot2.html#cb90-1"></a><span class="kw">ggplot</span>(gastos) <span class="op">+</span></span>
<span id="cb90-2"><a href="gráficos-con-ggplot2.html#cb90-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(quintil, <span class="dt">fill =</span> region_destino))</span></code></pre></div>
<p><img src="DT6_files/figure-html/unnamed-chunk-64-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Al <em>mapear</em> una variable distinta, se puede visualizar información extra.
En el gráfico, cada barra está compuesta de 8 barras apiladas cuya altura representa la cantidad de hogares que viajaron a cada región y están en cada cuantil.
Este “apilamiento” de las barras es la opción de posición por defecto, pero puede cambiarse con el argumento “position”.</p>
<p>La posición por defecto es “stack”.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="gráficos-con-ggplot2.html#cb91-1"></a><span class="kw">ggplot</span>(gastos) <span class="op">+</span></span>
<span id="cb91-2"><a href="gráficos-con-ggplot2.html#cb91-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(quintil, <span class="dt">fill =</span> region_destino), <span class="dt">position =</span> <span class="st">&quot;stack&quot;</span>)</span></code></pre></div>
<p><img src="DT6_files/figure-html/unnamed-chunk-65-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p><code>position = "identity"</code> colocará cada barra comenzando en cero quedando todas superpuestas.
Para ver esa superposición, debemos hacer que las barras sean ligeramente transparentes configurando el <code>alpha</code> a un valor pequeño.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="gráficos-con-ggplot2.html#cb92-1"></a><span class="kw">ggplot</span>(gastos) <span class="op">+</span></span>
<span id="cb92-2"><a href="gráficos-con-ggplot2.html#cb92-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(quintil, <span class="dt">fill =</span> region_destino), <span class="dt">alpha =</span> <span class="fl">0.2</span>, <span class="dt">position =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<p><img src="DT6_files/figure-html/unnamed-chunk-66-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p><code>position = "fill"</code> apila las barras al igual que <code>position = "stack"</code>, pero transforma los datos para que cada conjunto de barras apiladas tenga la misma altura.
Esto hace que sea más fácil comparar proporciones entre grupos.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="gráficos-con-ggplot2.html#cb93-1"></a><span class="kw">ggplot</span>(gastos) <span class="op">+</span></span>
<span id="cb93-2"><a href="gráficos-con-ggplot2.html#cb93-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(quintil, <span class="dt">fill =</span> region_destino),  <span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>)</span></code></pre></div>
<p><img src="DT6_files/figure-html/unnamed-chunk-67-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p><code>position = "dodge"</code> coloca las barras una al lado de la otra.
Esto hace que sea más fácil comparar valores individuales.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="gráficos-con-ggplot2.html#cb94-1"></a><span class="kw">ggplot</span>(gastos) <span class="op">+</span></span>
<span id="cb94-2"><a href="gráficos-con-ggplot2.html#cb94-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(quintil, <span class="dt">fill =</span> region_destino),  <span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p><img src="DT6_files/figure-html/unnamed-chunk-68-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="gráficos-de-caja" class="section level2">
<h2><span class="header-section-number">6.8</span> Gráficos de caja</h2>
<p>Los diagramas de caja –mejor conocidos como boxplots– calculan un resumen de los valores centrales y de dispersión de la distribución de los datos.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="gráficos-con-ggplot2.html#cb95-1"></a><span class="kw">ggplot</span>(gastos, <span class="kw">aes</span>(region_destino, gasto)) <span class="op">+</span></span>
<span id="cb95-2"><a href="gráficos-con-ggplot2.html#cb95-2"></a><span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span></span>
<span id="cb95-3"><a href="gráficos-con-ggplot2.html#cb95-3"></a><span class="st">  </span><span class="kw">scale_y_log10</span>()</span></code></pre></div>
<pre><code>## Warning: Transformation introduced infinite values in continuous y-axis</code></pre>
<pre><code>## Warning: Removed 853 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="DT6_files/figure-html/unnamed-chunk-69-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>La línea central de la caja corresponde a la <strong>mediana</strong> (el valor que toma el dato central) y los extremos de la caja son los <strong>cuartiles 1 y 3</strong>, definiendo así el <strong>rango intercuartil</strong> (IQR).
Los extremos están definidos como el valor observado que no esté más lejos de <strong>1.5*IQR</strong> de la mediana y los puntos son las observaciones que se escapan de ese rango, que pueden ser considerados <strong>outliers</strong> o <strong>valores extremos</strong>.</p>
<p>Los boxplot brindan algo de información sobre la distribución de los datos pero al mismo tiempo <em>esconden</em> la forma de la distribución y el número de datos que se usaron para generarlos.
Por esta razón también existen <code>geom_violin()</code> y <code>geom_jitter()</code>.</p>
<div class="alert alert-info">
<p><strong>Segundo desafío</strong></p>
<ol style="list-style-type: decimal">
<li>Volvé a graficar la distribución del precio para cada tipo de claridad pero ahora usando <code>geom_violin()</code> y <code>geom_jitter()</code>.</li>
<li>¿Qué ventajas y desventajas encuentran respecto de <code>geom_boxplot()</code>?</li>
</ol>
</div>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="gráficos-con-ggplot2.html#cb98-1"></a><span class="kw">ggplot</span>(gastos, <span class="kw">aes</span>(region_destino, gasto)) <span class="op">+</span></span>
<span id="cb98-2"><a href="gráficos-con-ggplot2.html#cb98-2"></a><span class="st">  </span><span class="kw">geom_violin</span>() <span class="op">+</span></span>
<span id="cb98-3"><a href="gráficos-con-ggplot2.html#cb98-3"></a><span class="st">  </span><span class="kw">scale_y_log10</span>()</span></code></pre></div>
<pre><code>## Warning: Transformation introduced infinite values in continuous y-axis</code></pre>
<pre><code>## Warning: Removed 853 rows containing non-finite values (stat_ydensity).</code></pre>
<p><img src="DT6_files/figure-html/unnamed-chunk-70-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="gráficos-con-ggplot2.html#cb101-1"></a><span class="kw">ggplot</span>(gastos, <span class="kw">aes</span>(region_destino, gasto)) <span class="op">+</span></span>
<span id="cb101-2"><a href="gráficos-con-ggplot2.html#cb101-2"></a><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">0.1</span>) <span class="op">+</span></span>
<span id="cb101-3"><a href="gráficos-con-ggplot2.html#cb101-3"></a><span class="st">  </span><span class="kw">scale_y_log10</span>()</span></code></pre></div>
<pre><code>## Warning: Transformation introduced infinite values in continuous y-axis</code></pre>
<pre><code>## Warning: Removed 853 rows containing missing values (geom_point).</code></pre>
<p><img src="DT6_files/figure-html/unnamed-chunk-71-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="alert alert-success">
<p>Cuando nuestra base de datos es muy grande corremos el riesgo de generar de que los elementos del gráfico estén tan juntos que se solapen y no se vean.
Esto se conoce como <strong>overplotting</strong>.
La tabla <code>gastos</code> tiene 27149 observaciones y al graficar un punto por cada una, aún si están separados por la región, quedan superpuestos.</p>
<p>Por esto es que en el último gráfico los puntos son muy chiquitos y con transparencia.</p>
</div>
</div>
<div id="graficando-en-múltiples-paneles" class="section level2">
<h2><span class="header-section-number">6.9</span> Graficando en múltiples paneles</h2>
<p>En un gráfico anterior mostramos la cantidad de hogares en cada quintil en función de la región de destino mapeando la variable <code>region_destino</code> al relleno de las columnas:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="gráficos-con-ggplot2.html#cb104-1"></a><span class="kw">ggplot</span>(gastos) <span class="op">+</span></span>
<span id="cb104-2"><a href="gráficos-con-ggplot2.html#cb104-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(quintil, <span class="dt">y =</span> <span class="kw">stat</span>(prop), <span class="dt">fill =</span> region_destino),  <span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p><img src="DT6_files/figure-html/unnamed-chunk-72-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Este gráfico permite comparar diferencias entre regiones para un mismo quintil, pero no permite comparar muy bien la distribución de ingresos en función de la región de destino.</p>
<p>Este problema podría resolverse generando un gráfico por cada región filtrando las observaciones correspondientes.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="gráficos-con-ggplot2.html#cb105-1"></a>gastos <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-2"><a href="gráficos-con-ggplot2.html#cb105-2"></a><span class="st">  </span><span class="kw">filter</span>(region_destino <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-3"><a href="gráficos-con-ggplot2.html#cb105-3"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb105-4"><a href="gráficos-con-ggplot2.html#cb105-4"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(quintil, <span class="dt">y =</span> <span class="kw">stat</span>(prop)),  <span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p><img src="DT6_files/figure-html/unnamed-chunk-73-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Pero sería muchísimo trabajo si tenés que hacer esto para cada una de las 8 regiones.
Excepto que ggplot2 tiene una forma de automatizar eso utilizando paneles:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="gráficos-con-ggplot2.html#cb106-1"></a><span class="kw">ggplot</span>(gastos) <span class="op">+</span></span>
<span id="cb106-2"><a href="gráficos-con-ggplot2.html#cb106-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(quintil, <span class="dt">y =</span> <span class="kw">stat</span>(prop)),  <span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="op">+</span></span>
<span id="cb106-3"><a href="gráficos-con-ggplot2.html#cb106-3"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>region_destino)</span></code></pre></div>
<p><img src="DT6_files/figure-html/unnamed-chunk-74-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Esta nueva capa con <code>facet_wrap()</code> divide al gráfico inicial en 8 paneles o <em>facets</em>, uno por cada región.
Esta función requiere saber que variable será la responsable de separar los paneles y para eso se usa la <strong>notación de fórmula</strong> de R: <code>~ region_destino</code>.
Esto se lee como generar paneles <em>en función de</em> <code>region_destino</code>.</p>
<p>Una hipótesis razonable podría ser que la distribución de ingresos en cada región también varía según el trimestre.
Para ver esto, habría que hacer el gráfico de barras para cada combinación de región de destino y trimestre.
En ggplot2 esto se resuelve agregando más variables que definan los paneles “sumando” variables en la fórmula</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="gráficos-con-ggplot2.html#cb107-1"></a><span class="kw">ggplot</span>(gastos) <span class="op">+</span></span>
<span id="cb107-2"><a href="gráficos-con-ggplot2.html#cb107-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(quintil, <span class="dt">y =</span> <span class="kw">stat</span>(prop)),  <span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="op">+</span></span>
<span id="cb107-3"><a href="gráficos-con-ggplot2.html#cb107-3"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>region_destino <span class="op">+</span><span class="st"> </span>trimestre)</span></code></pre></div>
<p><img src="DT6_files/figure-html/unnamed-chunk-75-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Esto se lee como generar paneles *“en función de* <code>region_destino</code> y <code>trimestre</code>”.</p>
<p>Una alternativa que funciona mejor cuando se hacen paneles en función de dos o más variables es que en vez de organizar los paneles uno luego del otro, tengan una organización.
Por ejemplo, que los paneles se organicen en filas según la región de destino y en columna según el trimestre.
Para eso hay que reemplazar <code>facet_wrap()</code> por <code>facet_grid()</code> y cambiar la formula un poco.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="gráficos-con-ggplot2.html#cb108-1"></a><span class="kw">ggplot</span>(gastos) <span class="op">+</span></span>
<span id="cb108-2"><a href="gráficos-con-ggplot2.html#cb108-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(quintil, <span class="dt">y =</span> <span class="kw">stat</span>(prop)),  <span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="op">+</span></span>
<span id="cb108-3"><a href="gráficos-con-ggplot2.html#cb108-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(region_destino <span class="op">~</span><span class="st"> </span>trimestre)</span></code></pre></div>
<p><img src="DT6_files/figure-html/unnamed-chunk-76-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>¿Ves como quedan los paneles más organizados y fácil es de leer?
Esta organización permite comparar regiones para un trimestre en particular comparando gráficos en la vertical, y comparar trimestres para una misma región leyendo los gráficos en horizontal.</p>
<p>La formula <code>region_destino ~ trimestre</code> indica que <code>region_destino</code> define las filas y <code>trimestre</code> define las columnas.</p>
<div class="alert alert-info">
<p><strong>Tercer desafío</strong></p>
<p>Generá boxplots para analizar como se comporta el <code>gasto</code> de cada familia en función del quintil al que pertenecen para cada región.</p>
<pre><code>## Warning: Transformation introduced infinite values in continuous y-axis</code></pre>
<pre><code>## Warning: Continuous x aesthetic -- did you forget aes(group=...)?</code></pre>
<pre><code>## Warning: Removed 853 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="DT6_files/figure-html/unnamed-chunk-77-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="gráficos-de-líneas-suavizas" class="section level2">
<h2><span class="header-section-number">6.10</span> Gráficos de líneas suavizas</h2>
<p>Antes viste este gráfico que parece mostrar que la cantidad de visitantes residentes estuvo aumentando entre 2008 y 2020 hasta que las restricciones por la pandemia hicieron que esta cantidad se desplomara.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="gráficos-con-ggplot2.html#cb112-1"></a>parques <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb112-2"><a href="gráficos-con-ggplot2.html#cb112-2"></a><span class="st">  </span><span class="kw">group_by</span>(<span class="dt">trimestre =</span> lubridate<span class="op">::</span><span class="kw">month</span>(indice_tiempo), region) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb112-3"><a href="gráficos-con-ggplot2.html#cb112-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">residentes =</span> residentes <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(residentes)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb112-4"><a href="gráficos-con-ggplot2.html#cb112-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(indice_tiempo, residentes)) <span class="op">+</span></span>
<span id="cb112-5"><a href="gráficos-con-ggplot2.html#cb112-5"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color=</span> region)) </span></code></pre></div>
<p><img src="DT6_files/figure-html/unnamed-chunk-78-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Una forma de guiar al ojo a ver esta tendencia e ignorar las fluctuaciones trimestre a trimestre es usando una línea suave.
Las líneas de suavizado ajustan un modelo a los datos y luego grafican las predicciones del modelo.
Sin entrar en muchos detalles, se puede aplicar distintos modelos y la elección del mismo dependerá de los datos.</p>
<p>En ggplot2 se puede agregar una línea suave agregando una capa con <code>geom_smooth()</code>.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="gráficos-con-ggplot2.html#cb113-1"></a>parques <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb113-2"><a href="gráficos-con-ggplot2.html#cb113-2"></a><span class="st">  </span><span class="kw">filter</span>(region <span class="op">==</span><span class="st"> &quot;patagonia&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb113-3"><a href="gráficos-con-ggplot2.html#cb113-3"></a><span class="st">  </span><span class="kw">group_by</span>(<span class="dt">trimestre =</span> lubridate<span class="op">::</span><span class="kw">month</span>(indice_tiempo), region) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb113-4"><a href="gráficos-con-ggplot2.html#cb113-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">residentes =</span> residentes <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(residentes)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb113-5"><a href="gráficos-con-ggplot2.html#cb113-5"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(indice_tiempo, residentes)) <span class="op">+</span></span>
<span id="cb113-6"><a href="gráficos-con-ggplot2.html#cb113-6"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> region)) <span class="op">+</span></span>
<span id="cb113-7"><a href="gráficos-con-ggplot2.html#cb113-7"></a><span class="st">  </span><span class="kw">geom_smooth</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="DT6_files/figure-html/unnamed-chunk-79-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>(Este gráfico además filtra sólo la región de Patagonia para que se vea más claramente.)</p>
<p>Como dice en el mensaje, por defecto <code>geom_smooth()</code> suaviza los datos usando el método <em>loess</em> (<a href="https://es.wikipedia.org/wiki/Regresi%C3%B3n_local">regresión lineal local</a>).
Seguramente va a ser muy común que quieras ajustar una regresión lineal global.
En ese caso, hay que poner <code>method = "lm"</code>:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="gráficos-con-ggplot2.html#cb115-1"></a>parques <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb115-2"><a href="gráficos-con-ggplot2.html#cb115-2"></a><span class="st">  </span><span class="kw">filter</span>(region <span class="op">==</span><span class="st"> &quot;patagonia&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb115-3"><a href="gráficos-con-ggplot2.html#cb115-3"></a><span class="st">  </span><span class="kw">group_by</span>(<span class="dt">trimestre =</span> lubridate<span class="op">::</span><span class="kw">month</span>(indice_tiempo), region) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb115-4"><a href="gráficos-con-ggplot2.html#cb115-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">residentes =</span> residentes <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(residentes)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb115-5"><a href="gráficos-con-ggplot2.html#cb115-5"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(indice_tiempo, residentes)) <span class="op">+</span></span>
<span id="cb115-6"><a href="gráficos-con-ggplot2.html#cb115-6"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> region)) <span class="op">+</span></span>
<span id="cb115-7"><a href="gráficos-con-ggplot2.html#cb115-7"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="DT6_files/figure-html/unnamed-chunk-80-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>El área gris muestra el intervalo de confianza al rededor de este suavizado.</p>
<p>Cómo cualquier geom, podemos modificar el color, el grosor de la línea y casi cualquier cosa que se te ocurra.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="gráficos-con-ggplot2.html#cb117-1"></a>parques <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb117-2"><a href="gráficos-con-ggplot2.html#cb117-2"></a><span class="st">  </span><span class="kw">group_by</span>(<span class="dt">trimestre =</span> lubridate<span class="op">::</span><span class="kw">month</span>(indice_tiempo), region) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb117-3"><a href="gráficos-con-ggplot2.html#cb117-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">residentes =</span> residentes <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(residentes)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb117-4"><a href="gráficos-con-ggplot2.html#cb117-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(indice_tiempo, residentes)) <span class="op">+</span></span>
<span id="cb117-5"><a href="gráficos-con-ggplot2.html#cb117-5"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> region)) <span class="op">+</span></span>
<span id="cb117-6"><a href="gráficos-con-ggplot2.html#cb117-6"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">color =</span> region))</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="DT6_files/figure-html/unnamed-chunk-81-1.png" width="100%" style="display: block; margin: auto;" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="manipulación-de-datos-ordenados.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="manipulación-de-datos-ordenados-usando-dplyr-y-tidyr-ii.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["DT6.pdf", "DT6.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
